<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hypass | ä¼æ¥­å“¡å·¥å°ˆå€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>body{background:linear-gradient(135deg,#f8fafc 0%,#e0f2fe 100%);-webkit-tap-highlight-color:transparent}.app-view{display:none}.app-view.active{display:block;animation:fadeIn .2s ease-in-out}.glass-card{background:rgba(255,255,255,.95);box-shadow:0 4px 20px rgba(0,0,0,.05);border:1px solid rgba(255,255,255,.6)}.nav-item.active{color:#0284c7;transform:translateY(-2px);font-weight:900}@keyframes fadeIn{from{opacity:0;transform:translateY(3px)}to{opacity:1;transform:translateY(0)}}.modal{display:none}.modal.active{display:flex;z-index:100}.no-scrollbar::-webkit-scrollbar{display:none}</style>
</head>
<body class="text-slate-800 font-sans min-h-screen pb-20">
    <header class="bg-slate-900 text-white px-5 py-3 flex justify-between items-center shadow-md sticky top-0 z-50">
        <div><h1 class="text-xl font-black italic uppercase tracking-wider">Hypass</h1><span class="text-[9px] text-sky-400 tracking-widest">ENTERPRISE</span></div><div id="user-status" class="text-[10px] font-bold bg-white/10 px-3 py-1.5 rounded-full border border-white/20">é€£ç·šä¸­...</div>
    </header>
    <main class="container mx-auto p-4 max-w-md">
        <div id="sys-loading" class="text-center py-32 active-view"><div class="animate-spin h-8 w-8 border-4 border-sky-600 border-t-transparent rounded-full mx-auto mb-3"></div><p class="text-xs text-slate-500 font-bold">è³‡æ–™åŒæ­¥ä¸­...</p></div>
        <div id="sys-pending" class="text-center py-24 hidden"><div class="text-5xl mb-4 grayscale">â³</div><h2 class="text-xl font-black">å¸³è™Ÿå¯©æ ¸ä¸­</h2><p class="text-xs text-slate-500 mt-2">è€é—†å°‡æ–¼ 4 å°æ™‚å…§æ ¸å‡†</p></div>

        <div id="view-onboarding" class="hidden glass-card p-5 rounded-2xl shadow-xl">
            <h2 class="text-lg font-black mb-4 text-center">æ–°é€²å“¡å·¥å»ºæª”</h2>
            <form id="onboarding-form" class="space-y-3">
                <input type="text" name="full_name" placeholder="çœŸå¯¦å§“å" required class="w-full p-2.5 bg-slate-50 rounded-xl text-sm border outline-none">
                <input type="text" name="id_number" placeholder="èº«åˆ†è­‰å­—è™Ÿ" required class="w-full p-2.5 bg-slate-50 rounded-xl text-sm border outline-none">
                <div class="grid grid-cols-2 gap-2"><input type="email" name="email" placeholder="é›»éƒµ" required class="p-2.5 bg-slate-50 rounded-xl text-xs border"><input type="tel" name="phone" placeholder="æ‰‹æ©Ÿ" required class="p-2.5 bg-slate-50 rounded-xl text-xs border"></div>
                
                <div class="grid grid-cols-3 gap-2">
                    <div class="col-span-1">
                        <select name="work_region" required class="w-full p-2.5 bg-slate-50 rounded-xl text-xs border font-bold text-slate-700">
                            <option value="" disabled selected>å·¥ä½œç¸£å¸‚</option>
                            <option value="åŸºéš†å¸‚">åŸºéš†å¸‚</option><option value="å°åŒ—å¸‚">å°åŒ—å¸‚</option><option value="æ–°åŒ—å¸‚">æ–°åŒ—å¸‚</option><option value="æ¡ƒåœ’å¸‚">æ¡ƒåœ’å¸‚</option><option value="æ–°ç«¹å¸‚">æ–°ç«¹å¸‚</option><option value="æ–°ç«¹ç¸£">æ–°ç«¹ç¸£</option><option value="è‹—æ —ç¸£">è‹—æ —ç¸£</option><option value="å°ä¸­å¸‚">å°ä¸­å¸‚</option><option value="å½°åŒ–ç¸£">å½°åŒ–ç¸£</option><option value="å—æŠ•ç¸£">å—æŠ•ç¸£</option><option value="é›²æ—ç¸£">é›²æ—ç¸£</option><option value="å˜‰ç¾©å¸‚">å˜‰ç¾©å¸‚</option><option value="å˜‰ç¾©ç¸£">å˜‰ç¾©ç¸£</option><option value="å°å—å¸‚">å°å—å¸‚</option><option value="é«˜é›„å¸‚">é«˜é›„å¸‚</option><option value="å±æ±ç¸£">å±æ±ç¸£</option><option value="å®œè˜­ç¸£">å®œè˜­ç¸£</option><option value="èŠ±è“®ç¸£">èŠ±è“®ç¸£</option><option value="å°æ±ç¸£">å°æ±ç¸£</option><option value="æ¾æ¹–ç¸£">æ¾æ¹–ç¸£</option><option value="é‡‘é–€ç¸£">é‡‘é–€ç¸£</option><option value="é€£æ±Ÿç¸£">é€£æ±Ÿç¸£</option>
                        </select>
                    </div>
                    <div class="col-span-2">
                        <input type="text" name="address" placeholder="é€šè¨Šåœ°å€ (æ³•å¾‹é€é”åœ°)" required class="w-full p-2.5 bg-slate-50 rounded-xl text-xs border outline-none">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2"><div><label class="text-[9px] font-bold text-slate-500 ml-1">å…¥è·æ—¥æœŸ</label><input type="date" name="onboarding_date" required class="w-full p-2.5 bg-slate-50 rounded-xl text-xs border"></div><div><label class="text-[9px] font-bold text-slate-500 ml-1">é è¨­æ‰“å¡æ“šé»</label><select id="reg-branch" class="w-full p-2.5 bg-slate-50 rounded-xl text-xs border"></select></div></div>
                <div class="p-3 bg-emerald-50 rounded-xl border border-emerald-100">
                    <h3 class="text-[10px] font-black text-emerald-800 mb-2">è²¡å‹™èˆ‡çœ·å±¬è³‡æ–™</h3>
                    <div class="grid grid-cols-2 gap-2 mb-3"><input type="text" name="bank_name" placeholder="éŠ€è¡Œåç¨±" required class="p-2 text-xs border rounded-lg bg-white"><input type="text" name="bank_code" placeholder="ä»£ç¢¼(ä¾‹:808)" required class="p-2 text-xs border rounded-lg bg-white"><input type="text" name="bank_user_name" placeholder="æˆ¶å" required class="p-2 text-xs border rounded-lg bg-white"><input type="text" name="bank_account" placeholder="éŠ€è¡Œå¸³è™Ÿ" required class="p-2 text-xs border rounded-lg bg-white"></div>
                    <div class="flex justify-between items-center border-t border-emerald-100 pt-2"><span class="text-[9px] font-bold text-emerald-900">å¥ä¿çœ·å±¬åŠ ä¿äººæ•¸</span><input type="number" name="dependents_count" value="0" min="0" required class="w-16 p-1 text-center text-xs border rounded bg-white"></div>
                </div>
                <div class="grid grid-cols-2 gap-2"><input type="text" name="emergency_name" placeholder="ç·Šæ€¥è¯çµ¡äºº" required class="p-2.5 bg-slate-50 border rounded-xl text-xs"><input type="tel" name="emergency_phone" placeholder="é›»è©±" required class="p-2.5 bg-slate-50 border rounded-xl text-xs"></div>
                <div class="bg-slate-900 text-white p-4 rounded-xl mt-3"><h3 class="text-[10px] font-black text-amber-400 mb-2 border-b border-white/20 pb-1">âš–ï¸ è˜åƒ±åˆç´„ç°½ç½²</h3><label class="flex items-start space-x-2 text-[9px] mb-2"><input type="checkbox" id="chk1" onchange="checkForm()"><span>ã€GPSã€‘åŒæ„å®šä½ç‚ºå‡ºå‹¤å”¯ä¸€ä¾æ“šã€‚</span></label><label class="flex items-start space-x-2 text-[9px] mb-2"><input type="checkbox" id="chk2" onchange="checkForm()"><span>ã€å®ˆå‰‡ã€‘åŒæ„ç‰¹ä¼‘å„ªå…ˆæŠµæ‰£é²åˆ°ä»¥ç¶­æŒå…¨è–ªã€‚</span></label><label class="flex items-start space-x-2 text-[9px]"><input type="checkbox" id="chk3" onchange="checkForm()"><span>ã€ä¿å¯†ã€‘åŒæ„åš´å®ˆæ©Ÿå¯†ï¼Œé•é¡˜è³ å„Ÿã€‚</span></label></div>
                <button type="submit" id="btn-submit" disabled class="w-full bg-sky-600 disabled:bg-slate-300 text-white font-black py-3 rounded-xl mt-2 transition">æ•¸ä½ç°½ç½²ä¸¦é€å‡º</button>
            </form>
        </div>

        <div id="view-dashboard" class="hidden space-y-4">
            <div id="tab-home" class="app-view active space-y-3">
                <div class="bg-amber-50 border border-amber-200 p-3 rounded-xl flex flex-col shadow-sm"><div class="flex items-center space-x-1.5 mb-2 border-b border-amber-200/50 pb-1"><span class="text-sm">ğŸ“¢</span><h4 class="text-[10px] font-black text-amber-900 tracking-widest">å…¬å¸å…¬å‘Š (1å¹´å…§)</h4></div><div id="ui-bulletin" class="pl-2 pr-1 max-h-32 overflow-y-auto no-scrollbar space-y-2">è¼‰å…¥ä¸­...</div></div>
                <div class="bg-slate-900 p-6 rounded-2xl text-white shadow-xl relative overflow-hidden"><h3 id="ui-name" class="text-2xl font-black mb-1">--</h3><p id="ui-tenure" class="text-[10px] text-sky-300 font-bold mb-3 tracking-wider">ğŸ•’ å…¥è·æ—¥è¼‰å…¥ä¸­</p><div class="flex justify-between items-center bg-white/10 p-3 rounded-xl border border-white/10"><span class="text-[10px] font-black text-slate-300">æ³•å®šç‰¹ä¼‘é¤˜é¡</span><span id="ui-leave" class="text-xl font-black">-- å¤© -- å°æ™‚</span></div></div>
                <div class="glass-card p-4 rounded-2xl shadow-sm"><button onclick="loadPunchHistory()" class="w-full mb-3 text-xs font-bold text-sky-700 bg-sky-50 py-2.5 rounded-xl border border-sky-100 flex justify-center items-center space-x-1 active:scale-95 transition"><span>ğŸ”</span><span>æŸ¥è©¢æ‰“å¡ç´€éŒ„</span></button>
                <select id="punch-branch" class="w-full mb-3 text-sm font-bold bg-white text-slate-700 border border-slate-200 rounded-xl p-2.5 outline-none text-center"></select>
                <div class="grid grid-cols-2 gap-3"><button onclick="punch('IN')" class="bg-sky-600 text-white py-8 rounded-xl font-black text-lg shadow-md active:scale-95 flex flex-col items-center transition"><span class="text-2xl mb-1">ğŸ¢</span>ä¸Šç­</button><button onclick="punch('OUT')" class="bg-white text-slate-700 border border-slate-200 py-8 rounded-xl font-black text-lg shadow-sm active:scale-95 flex flex-col items-center transition"><span class="text-2xl mb-1 grayscale">ğŸ </span>ä¸‹ç­</button></div></div>
            </div>

            <div id="tab-leave" class="app-view space-y-3">
                <h3 class="font-black text-lg text-slate-900 border-l-4 border-amber-500 pl-2">ç·šä¸Šè«‹å‡å–®</h3>
                <div class="glass-card p-5 rounded-2xl shadow-sm">
                    <div class="bg-amber-50/80 p-3 rounded-xl border border-amber-200 mb-4 text-[10px] text-amber-900 leading-relaxed shadow-inner"><h4 class="font-black mb-1.5 flex items-center"><span>ğŸ“‹ ä¼æ¥­è«‹å‡è¦ç¯„</span></h4><ul class="space-y-1 pl-4 list-disc marker:text-amber-400"><li><strong class="font-black text-amber-950">çŸ­æœŸ (1-2å¤©)</strong>ï¼šå»ºè­° 3å¤©~1é€±å‰æå‡ºã€‚</li><li><strong class="font-black text-amber-950">é•·æœŸ (3å¤©ä»¥ä¸Š)</strong>ï¼šå»ºè­° 2é€±~1å€‹æœˆå‰æå‡ºï¼Œä»¥ä¾¿äººåŠ›èª¿åº¦ã€‚</li><li><strong class="font-black text-amber-950">çªç™¼ç‹€æ³</strong>ï¼šæ‡‰æ–¼ä¸Šç­å‰ç¬¬ä¸€æ™‚é–“å‘ŠçŸ¥ï¼Œè¿”å·¥ç›¡é€Ÿè£œè¾¦ã€‚</li></ul></div>
                    <form id="leave-form" onsubmit="submitLeave(event)" class="space-y-3 border-b border-slate-100 pb-5 mb-4">
                        <select name="leave_type" id="leave-type-select" onchange="checkLeaveType()" class="w-full bg-white border border-slate-200 p-2.5 rounded-xl text-sm font-bold"><option value="ç‰¹ä¼‘"
