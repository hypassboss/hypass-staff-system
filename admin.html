<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>HYPASS | è€é—†æŒ‡æ®ä¸­å¿ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>.tab-content { display: none; } .tab-content.active { display: block; }</style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen">
    <header class="bg-slate-900 text-white p-4 flex justify-between items-center shadow-lg sticky top-0 z-50">
        <h1 class="text-xl font-black italic text-amber-400">HYPASS ADMIN</h1>
        <button onclick="location.reload()" id="logout" class="hidden text-xs bg-red-600 px-4 py-2 rounded font-bold">ç™»å‡º</button>
    </header>

    <div id="login-box" class="flex flex-col items-center justify-center py-32">
        <div class="bg-white p-8 rounded-[2rem] shadow-xl w-full max-w-sm text-center">
            <h2 class="text-2xl font-black mb-6">æœ€é«˜æ¬Šé™è§£é–</h2>
            <input type="password" id="pin" placeholder="ç®¡ç†å¯†ç¢¼" class="w-full border p-4 text-center text-2xl tracking-[0.5em] rounded-xl outline-none mb-6">
            <button onclick="login()" class="w-full bg-slate-900 text-white font-black py-4 rounded-xl active:scale-95">è§£é–</button>
        </div>
    </div>

    <main id="main-dash" class="container mx-auto p-4 max-w-4xl hidden">
        <div class="flex space-x-2 mb-6 bg-white p-2 rounded-2xl shadow-sm border">
            <button onclick="st('pend')" id="t-pend" class="t-btn active px-5 py-3 text-xs font-black bg-slate-900 text-white rounded-xl">å¾…å¯©æ ¸ ğŸ”´</button>
            <button onclick="st('emps')" id="t-emps" class="t-btn px-5 py-3 text-xs font-black text-slate-500 rounded-xl">å“¡å·¥åƒæ•¸</button>
            <button onclick="st('brs')" id="t-brs" class="t-btn px-5 py-3 text-xs font-black text-slate-500 rounded-xl">æ“šé» ğŸ“</button>
        </div>

        <section id="pend" class="tab-content active space-y-4">
            <h3 class="font-black border-l-4 border-blue-500 pl-3 text-lg">æ–°é€²å“¡å·¥æ ¸å‡†</h3>
            <div id="list-pend" class="space-y-3"></div>
        </section>

        <section id="emps" class="tab-content space-y-4">
            <h3 class="font-black border-l-4 border-emerald-500 pl-3 text-lg">åº•è–ªèˆ‡ç‰¹ä¼‘è¨­å®š (240H)</h3>
            <div id="list-emps" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </section>

        <section id="brs" class="tab-content space-y-4">
            <h3 class="font-black border-l-4 border-amber-500 pl-3 text-lg">æ–°å¢åˆ†åº—æ“šé»</h3>
            <div class="bg-white p-5 rounded-2xl shadow-sm border mb-4">
                <div class="grid grid-cols-2 gap-3 mb-3"><input type="text" id="b-n" placeholder="åˆ†åº—å" class="p-3 border rounded-xl"><input type="text" id="b-a" placeholder="åœ°å€" class="p-3 border rounded-xl"><input type="number" id="b-la" placeholder="ç·¯åº¦" class="p-3 border rounded-xl"><input type="number" id="b-ln" placeholder="ç¶“åº¦" class="p-3 border rounded-xl"></div>
                <button onclick="addBr()" class="w-full bg-amber-500 text-white font-black py-3 rounded-xl">ï¼‹ æ–°å¢</button>
            </div>
            <div id="list-brs" class="space-y-3"></div>
        </section>
    </main>

    <script>
        const _sb = supabase.createClient('https://obbcgmgkbazwpfvgbupg.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9iYmNnbWdrYmF6d3BmdmdidXBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNTUxNDQsImV4cCI6MjA4NjczMTE0NH0.UlCKV_BDRWToqtG8ol69USBKgehBYpB4aUdM25oNwM0');
        function login() { if(document.getElementById('pin').value==='888888'){ document.getElementById('login-box').style.display='none'; document.getElementById('main-dash').style.display='block'; loadAll(); } }
        function st(id) { document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active')); document.querySelectorAll('.t-btn').forEach(e=>{e.classList.remove('bg-slate-900','text-white'); e.classList.add('text-slate-500');}); document.getElementById(id).classList.add('active'); document.getElementById('t-'+id).classList.add('bg-slate-900','text-white'); }
        async function loadAll() {
            const { data: p } = await _sb.from('employees').select('*').eq('is_approved', false);
            document.getElementById('list-pend').innerHTML = p.map(e => `<div class="bg-white p-5 rounded-2xl border flex justify-between items-center"><h4 class="font-black">${e.full_name}</h4><button onclick="appr('${e.id}')" class="bg-blue-600 text-white font-black px-6 py-2 rounded-xl">é–‹é€š</button></div>`).join('') || 'ç„¡å¾…è¾¦äº‹é …';
            const { data: em } = await _sb.from('employees').select('*, leave_balances(*)').eq('is_approved', true);
            document.getElementById('list-emps').innerHTML = em.map(e => `<div class="bg-white p-5 rounded-2xl border space-y-2"><h4 class="font-black text-lg">${e.full_name}</h4><div class="flex justify-between items-center"><span class="text-xs font-bold text-slate-500">åº•è–ª</span><div class="flex"><input type="number" id="s-${e.id}" value="${e.base_salary}" class="border p-1 w-24 text-right rounded"><button onclick="uS('${e.id}')" class="bg-slate-200 text-[10px] p-1 ml-1 rounded">å­˜</button></div></div></div>`).join('');
            const { data: br } = await _sb.from('branch_locations').select('*');
            document.getElementById('list-brs').innerHTML = br.map(b => `<div class="bg-white p-4 rounded-xl border flex justify-between items-center"><div><p class="font-black text-sm">${b.branch_name}</p><p class="text-[10px] text-slate-500">${b.address}</p></div></div>`).join('');
        }
        async function appr(id) { await _sb.from('employees').update({is_approved:true}).eq('id',id); await _sb.from('leave_balances').insert([{employee_id:id, annual_leave_hours:0}]); loadAll(); alert('å·²é–‹é€š'); }
        async function uS(id) { await _sb.from('employees').update({base_salary:document.getElementById('s-'+id).value}).eq('id',id); alert('å·²æ›´æ–°åº•è–ª'); }
        async function addBr() { await _sb.from('branch_locations').insert([{ branch_name: document.getElementById('b-n').value, address: document.getElementById('b-a').value, lat: document.getElementById('b-la').value, lng: document.getElementById('b-ln').value }]); loadAll(); }
    </script>
</body>
</html>
